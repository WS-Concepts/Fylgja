// Fylgja (https://fylgja.dev)
// Licensed under MIT Open Source

@use "helper" as form;

$selectors: "input:not([type=checkbox],[type=radio],[type=range],[type=button],[type=reset],[type=submit]), textarea, select" !default;

// prettier-ignore
:where(#{$selectors}) {
	@include form.base;
	outline-offset: calc(
		(var(--form-border-width, #{form.$border-width}) + 1px) * -1
	);

	&:where(:placeholder-shown) {
		text-overflow: ellipsis;
	}

	&:focus {
		border-color: var(--form-active-color);
		outline-width: 1px;
	}

	&:is(:disabled, [readonly]:not(:focus)) {
		border-style: var(
			--form-disabled-border-style,
			#{form.$disabled-border-style}
		);
	}

	&:disabled {
		box-shadow: none;
		opacity: var(--form-disabled-opacity, #{form.$disabled-opacity});
		cursor: not-allowed;
	}
}

:where(input[type="color"]) {
	@include form.color;
}

:where(input[type="file"]) {
	@include form.file;
}

// Remove the inheritance of word-wrap in Safari
:where(select) {
	word-wrap: normal;
}

:where(select:not([multiple], [size]:not([size="1"]))) {
	@include form.select-icon;
}

// Remove the dropdown arrow only from text type inputs built with datalists in webkit browsers
// Chrome = calendar-picker-indicator
// iOS Safari = list-button
[list]:not([type*="date"], [type="month"], [type="week"], [type="time"]) {
	&::-webkit-calendar-picker-indicator,
	&::-webkit-list-button {
		width: 0;
		height: 0;
		margin: 0;
		padding: 0;
		visibility: hidden;
	}
}

:where(textarea) {
	min-block-size: var(
		--textarea-size,
		calc(3.5lh + var(--form-py, #{form.$padding-block}))
	);
	field-sizing: content; // Resize by default, disabled the rows attribute
	resize: vertical;
}

:where(label:has(input, select, textarea, progress, meter)) {
	display: block;
}

:where(label:has(input:is([type="radio"], [type="checkbox"]))) {
	inline-size: fit-content;
}

// Reset the default opacity in Firefox,
// and apply a default placeholder color to a semi-transparent version of the current text color
::placeholder {
	opacity: 1;
	color: color-mix(in srgb, currentcolor 54%, transparent);
}

// Nuke the default styles for the fieldset and legend,
// and let authors determine what styles it needs to be, or just blank
// This reset will keep the default style behavior, so adding the border and padding will make the legend float with the box
:where(fieldset) {
	min-inline-size: 0;
	margin: 0;
	padding: 0;
}

:where(legend) {
	padding: 0;
}

:where(fieldset + fieldset) {
	margin-block-start: 1em;
}

// Removes the extra space in older webkit browsers
::-webkit-search-decoration {
	-webkit-appearance: none;
}

// Fix extra space on date inputs, for Safari
::-webkit-datetime-edit,
::-webkit-datetime-edit-fields-wrapper,
::-webkit-datetime-edit-year-field,
::-webkit-datetime-edit-month-field,
::-webkit-datetime-edit-day-field,
::-webkit-datetime-edit-hour-field,
::-webkit-datetime-edit-minute-field,
::-webkit-datetime-edit-second-field,
::-webkit-datetime-edit-millisecond-field,
::-webkit-datetime-edit-meridiem-field {
	display: inline;
	padding-block: 0;
}

::-webkit-date-and-time-value {
	min-height: 1lh; // Prevent collapse of date field on iOS Safari, if the value is empty
	text-align: inherit; // Correct text alignment in iOS Safari
}
